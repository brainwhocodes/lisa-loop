#!/bin/bash
# Skill: ralph-run
# Description: Start the Ralph autonomous development loop
# Usage: ralph-run [--monitor] [--calls <n>] [--verbose]

set -e

MONITOR=""
CALLS=""
VERBOSE=""

# Parse arguments
while [[ $# -gt 0 ]]; do
    case $1 in
        --monitor|-m)
            MONITOR="--monitor"
            shift
            ;;
        --calls|-c)
            CALLS="--calls $2"
            shift 2
            ;;
        --verbose|-v)
            VERBOSE="--verbose"
            shift
            ;;
        *)
            shift
            ;;
    esac
done

# Check for required files
if [[ ! -f "IMPLEMENTATION_PLAN.md" ]] && [[ ! -f "@fix_plan.md" ]]; then
    echo "Error: No plan file found"
    echo "Run 'ralph init' first to generate a plan"
    exit 1
fi

if [[ ! -f "PROMPT.md" ]] && [[ ! -f "AGENTS.md" ]]; then
    echo "Warning: No PROMPT.md or AGENTS.md found"
    echo "The loop will run but may lack project context"
fi

echo "Starting Ralph development loop..."

# Run ralph
if command -v ralph &>/dev/null; then
    ralph $MONITOR $CALLS $VERBOSE
else
    echo "Error: ralph command not found"
    echo "Build with: go build -o ralph ./cmd/ralph"
    exit 1
fi
