#!/bin/bash
# Skill: lint
# Description: Runs lint/typecheck if present
# Usage: source .codex/skills/lint

echo "üîç Running lint/typecheck..."

if [[ -f "package.json" ]]; then
    # Node.js/JavaScript project
    echo "Detected Node.js project"

    # Check for npm scripts
    if npm run lint 2>/dev/null; then
        echo "‚úÖ Running npm run lint..."
        npm run lint
    else
        echo "‚ÑπÔ∏è  No lint script in package.json"
    fi

    if npm run typecheck 2>/dev/null; then
        echo "‚úÖ Running npm run typecheck..."
        npm run typecheck
    else
        echo "‚ÑπÔ∏è  No typecheck script in package.json"
    fi

elif [[ -f "pyproject.toml" ]]; then
    # Python project with modern tooling
    echo "Detected Python project"

    if command -v ruff &>/dev/null; then
        echo "‚úÖ Running ruff check..."
        ruff check .
    fi

    if command -v mypy &>/dev/null; then
        echo "‚úÖ Running mypy..."
        mypy .
    fi

elif [[ -f "Cargo.toml" ]]; then
    # Rust project
    echo "Detected Rust project"

    echo "‚úÖ Running cargo clippy..."
    cargo clippy -- -D warnings
    echo "‚úÖ Running cargo fmt --check..."
    cargo fmt -- --check

elif [[ -f "go.mod" ]]; then
    # Go project
    echo "Detected Go project"

    if command -v gofmt &>/dev/null; then
        echo "‚úÖ Running gofmt..."
        gofmt -l .
    fi

    if command -v go vet &>/dev/null; then
        echo "‚úÖ Running go vet..."
        go vet ./...
    fi

else
    echo "‚ö†Ô∏è  No recognized lint tools found"
    echo "Supported: Node.js (npm run lint/typecheck), Python (ruff/mypy), Rust (cargo clippy), Go (gofmt)"
fi
