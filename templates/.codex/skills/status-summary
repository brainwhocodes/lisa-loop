#!/bin/bash
# Skill: status-summary
# Description: Prints/parses Ralph status.json + latest log pointers
# Usage: source .codex/skills/status-summary

echo "üìä Ralph Status Summary"
echo "======================"

# Check for status.json
if [[ -f "status.json" ]]; then
    echo ""
    echo "üìÑ Current Status (status.json):"
    cat status.json
else
    echo "‚ö†Ô∏è  status.json not found"
fi

# Check for logs directory
if [[ -d "logs" ]]; then
    echo ""
    echo "üìù Recent Logs:"
    echo "----------------"

    # Find the most recent log file
    latest_log=$(ls -t logs/*.log 2>/dev/null | head -1)

    if [[ -n "$latest_log" ]]; then
        echo "Latest log: $latest_log"
        echo ""
        echo "Last 20 lines:"
        tail -20 "$latest_log"
    else
        echo "No log files found in logs/"
    fi
else
    echo "‚ö†Ô∏è  logs/ directory not found"
fi

# Check for circuit breaker state
if [[ -f ".circuit_state" ]]; then
    echo ""
    echo "üîå Circuit Breaker:"
    echo "----------------"
    cat .circuit_state
fi

# Check for session state
if [[ -f ".codex_session_id" ]]; then
    echo ""
    echo "üîó Session ID:"
    echo "----------------"
    cat .codex_session_id
    echo ""
    if [[ -f ".codex_session_meta" ]]; then
        echo "Session metadata:"
        cat .codex_session_meta
    fi
fi

# Check for exit signals
if [[ -d ".exit_signals" ]]; then
    echo ""
    echo "üö™ Recent Exit Signals:"
    echo "----------------------"
    ls -lt .exit_signals/ | head -6
fi

echo ""
echo "======================"
